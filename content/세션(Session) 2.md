# 세션(Session) 이해하기

웹 애플리케이션 개발에서 **세션(Session)** 은 사용자의 상태를 유지하고 개인화된 경험을 제공하는 데 중요한 역할을 합니다. 이번 글에서는 세션의 개념, 필요성, 동작 방식, 관리 전략, 그리고 보안 고려 사항에 대해 알아보겠습니다.

## 1. 세션이란?

**세션(Session)** 은 사용자가 웹 애플리케이션에 접속하여 활동하는 일련의 기간을 의미하며, 이 기간 동안 사용자의 상태와 정보를 유지하는 기술을 말합니다. 세션을 통해 서버는 사용자를 식별하고, 로그인 상태 유지, 장바구니 정보 저장 등 **개인화된 서비스**를 제공합니다.

## 2. 세션의 필요성

HTTP 프로토콜은 **무상태(Stateless)** 프로토콜로, 웹 서버는 각 요청이 독립적으로 처리되며 이전의 요청 정보를 알 수 없습니다. 이러한 특성 때문에 다음과 같은 문제가 발생합니다.

- **사용자 구분 어려움**: 누가 어떤 요청을 보냈는지 식별할 수 없음.
- **상태 정보 유지 불가**: 로그인 상태나 장바구니 정보 등을 지속할 수 없음.

세션은 이러한 문제를 해결하기 위해 도입되었으며, 서버가 사용자의 상태 정보를 유지하여 일관된 서비스를 제공할 수 있도록 합니다.

## 3. 세션의 동작 방식

세션은 일반적으로 다음과 같은 과정으로 동작합니다.

1. **세션 생성**: 사용자가 웹 애플리케이션에 처음 접속하면, 서버는 고유한 세션 ID(Session ID)를 생성하고 세션 저장소에 빈 세션 객체를 생성합니다.
2. **세션 ID 전달**: 서버는 생성된 세션 ID를 클라이언트에게 쿠키(Cookie)로 전달합니다.
3. **상태 정보 저장**: 클라이언트의 요청에 따라 필요한 상태 정보를 세션에 저장합니다.
4. **세션 유지**: 이후 클라이언트는 요청 시마다 세션 ID를 포함하여 서버에 전달하고, 서버는 해당 세션 ID로 세션 정보를 조회하여 상태를 유지합니다.
5. **세션 만료 및 삭제**: 일정 기간 활동이 없거나 로그아웃하면 세션이 만료되고, 서버는 세션 정보를 삭제합니다.


## 4. 세션 관리 전략

세션 관리는 애플리케이션의 규모와 요구사항에 따라 다양한 방식으로 구현됩니다.

### 4.1 서버 메모리에 세션 저장

- **특징**: 서버의 메모리에 세션 정보를 저장합니다.
- **장점**: 구현이 간단하고 빠른 접근 속도를 가집니다.
- **단점**:
  - 서버 재시작 시 세션 정보 유실.
  - 서버가 여러 대인 경우 세션 공유 어려움.
- **적용 사례**: 단일 서버 환경이나 작은 규모의 애플리케이션.

### 4.2 데이터베이스에 세션 저장

- **특징**: 관계형 데이터베이스에 세션 정보를 저장합니다.
- **장점**: 세션 정보의 영속성 보장, 서버 간 세션 공유 가능.
- **단점**:
  - 데이터베이스 부하 증가로 성능 저하 가능.
  - 세션 데이터의 지속적인 읽기/쓰기가 필요하여 효율성 저하.
- **적용 사례**: 세션 정보의 보존이 중요하고 부하가 크지 않은 경우.

### 4.3 인메모리 세션 저장소 사용

- **특징**: [[Redis]], [[Memcached]] 등 인메모리 데이터 저장소에 세션 정보를 저장합니다.
- **장점**:
  - 빠른 데이터 접근 속도.
  - 서버 간 세션 공유 용이.
  - 수평 확장에 유리.
- **단점**:
  - 추가적인 인프라 구축 필요.
  - 데이터 영속성이 제한적(설정에 따라 다름).
- **적용 사례**: 대규모 트래픽 처리, 분산 서버 환경.

### 4.4 토큰 기반 인증(JWT 등)

- **특징**: 세션 정보를 클라이언트 측에 [[JWT(JSON Web Token)]] 형태로 저장하고 인증에 사용합니다.
- **장점**:
  - 서버 상태를 유지할 필요가 없어 확장에 유리.
  - 서버 부하 감소.
- **단점**:
  - 토큰 탈취 시 보안 위험 증가.
  - 토큰 내 정보 변경이 어렵고, 만료 전까지는 취소가 어려움.
- **적용 사례**: 모바일 앱, 마이크로서비스, RESTful API.

## 5. 세션의 보안 고려 사항

세션 관리는 사용자 정보와 인증 상태를 다루므로 보안에 특별히 신경 써야 합니다.

### 5.1 세션 ID 보호

- **예측 불가능한 세션 ID**: 세션 ID는 추측이 불가능하도록 충분한 길이와 랜덤성을 가져야 합니다.
- **HTTPS 사용**: 세션 ID를 안전하게 전송하기 위해 HTTPS로 통신하여 중간자 공격을 방지합니다.
- **[[HttpOnly 쿠키]] 속성**: 쿠키에 HttpOnly 속성을 설정하여 JavaScript에서 접근하지 못하도록 합니다.
- **Secure 속성**: 쿠키에 Secure 속성을 설정하여 HTTPS 통신에서만 쿠키가 전송되도록 합니다.

### 5.2 세션 만료 관리

- **적절한 세션 수명**: 세션의 유효 기간을 설정하여 불필요한 노출을 방지합니다.
- **비활동 타임아웃**: 일정 시간 동안 활동이 없으면 자동 로그아웃 처리합니다.

### 5.3 세션 고정(Session Fixation) 공격 방지

- **세션 재생성**: 로그인 시 기존 세션 ID를 폐기하고 새로운 세션 ID를 생성하여 사용합니다.
- **세션 ID 검증**: 요청마다 세션 ID의 적합성을 검증하여 의도치 않은 접근을 방지합니다.

### 5.4 크로스 사이트 요청 위조(CSRF) 방지

- **CSRF 토큰 사용**: 폼 전송 시 CSRF 방지 토큰을 활용하여 요청 위조를 방지합니다.
- **Referer 헤더 검증**: 요청의 출처를 확인하여 신뢰할 수 없는 요청을 차단합니다.

## 6. 결론

세션은 사용자 상태를 관리하고 개인화된 서비스를 제공하는 데 필수적인 요소입니다. 세션 관리 방식은 애플리케이션의 특성과 요구사항에 따라 신중하게 선택해야 하며, 특히 보안 측면에서의 고려가 중요합니다. 적절한 세션 관리 전략을 수립하여 안전하고 효율적인 웹 애플리케이션을 개발하시기 바랍니다.

---

**참고자료**

- [MDN Web Docs - 세션 관리](https://developer.mozilla.org/ko/docs/Web/HTTP/Session)
- [OWASP Top 10 - 세션 관리 취약점](https://owasp.org/www-project-top-ten/)
- [RFC 6265 - HTTP 상태 관리 메커니즘](https://tools.ietf.org/html/rfc6265)

---

# 세션 관리 방법 비교

| 방법                      | 장점                                       | 단점                                         | 사용 사례                    |
| ------------------------- | ------------------------------------------ | -------------------------------------------- | ---------------------------- |
| 서버 메모리 세션          | 구현 용이, 빠른 속도                       | 서버 간 공유 어려움, 세션 유실 위험             | 단일 서버, 소규모 서비스     |
| 데이터베이스 세션 저장    | 영속성 보장, 서버 간 공유 가능             | 성능 저하 가능, DB 부하 증가                    | 중소 규모 애플리케이션        |
| 인메모리 세션 저장소(Redis) | 빠른 속도, 확장성 우수, 세션 공유 가능     | 인프라 구축 필요, 복잡성 증가                    | 대규모 트래픽, 분산 시스템    |
| 토큰 기반 인증(JWT)       | 무상태 서버 구현, 확장성 우수             | 보안 이슈, 토큰 관리 어려움                     | 모바일 앱, API 서비스         |


---

세션 관리는 웹 애플리케이션의 핵심 요소 중 하나로, 효율성과 보안성을 모두 고려해야 합니다. 다양한 세션 관리 방법들의 특성을 이해하고, 자신의 애플리케이션에 가장 적합한 방법을 선택하여 안정적이고 사용자 친화적인 서비스를 제공하시기 바랍니다.

---