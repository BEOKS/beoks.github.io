### 1. í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ (Class Diagrams)


```mermaid
classDiagram
    class User {
        +String userId
        +String name
        +String email
    }

    class Room {
        +String roomId
        +String name
        +int capacity
        +String location
        +String description
    }

    class Booking {
        +String bookingId
        +String roomId
        +String userId
        +DateTime startTime
        +DateTime endTime
        +String title
        +BookingStatus status
    }

    class BookingRequestDto {
        +String roomId
        +String userId
        +String startTime
        +String endTime
        +String title
    }

    class BookingResponseDto {
        +String bookingId
        +String roomId
        +String userId
        +DateTime startTime
        +DateTime endTime
        +String title
        +String status
    }

    class BookingStatus {
        <<enumeration>>
        PENDING
        CONFIRMED
        CANCELLED
        COMPLETED
    }

    class BookingController {
        -BookingService bookingService
        +createBooking(request: BookingRequestDto): BookingResponseDto
    }

    class BookingService {
        -BookingRepository bookingRepository
        -RoomRepository roomRepository
        +createBooking(bookingDetails: BookingRequestDto): BookingResponseDto
        +isRoomAvailable(roomId: String, startTime: DateTime, endTime: DateTime): boolean
    }

    class BookingRepository {
        +save(booking: Booking): Booking
        +findOverlappingBookings(roomId: String, startTime: DateTime, endTime: DateTime): List~Booking~
        +findById(bookingId: String): Optional~Booking~
    }

    class RoomRepository {
        +findById(roomId: String): Optional~Room~
    }

    %% Relationships
    BookingController --> BookingService : uses
    BookingService --> BookingRepository : uses
    BookingService --> RoomRepository : uses

    BookingController ..> BookingRequestDto : depends on (parameter)
    BookingController ..> BookingResponseDto : depends on (return)
    BookingService ..> BookingRequestDto : depends on (parameter)
    BookingService ..> BookingResponseDto : depends on (return)

    BookingService ..> Booking : creates & manages
    BookingService ..> Room : uses (checks existence)

    BookingRepository ..> Booking : interacts with
    RoomRepository ..> Room : interacts with

    Booking "1" *-- "1" BookingStatus : has
    Booking "1" -- "1" Room : books (referenced by roomId)
    Booking "1" -- "1" User : made by (referenced by userId)
```


---

### 2. ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ (Sequence Diagrams)


```mermaid
sequenceDiagram
    participant U as ğŸ’»<br>ì‚¬ìš©ì(User)
    participant C as ğŸ“±<br>ì˜ˆì•½ ì»¨íŠ¸ë¡¤ëŸ¬<br>(BookingController)
    participant S as âš™ï¸<br>ì˜ˆì•½ ì„œë¹„ìŠ¤<br>(BookingService)
    participant R_Room as ğŸšª<br>íšŒì˜ì‹¤ ë ˆí¬ì§€í† ë¦¬<br>(RoomRepository)
    participant R_Booking as ğŸ“„<br>ì˜ˆì•½ ë ˆí¬ì§€í† ë¦¬<br>(BookingRepository)
    participant DB as ğŸ›¢ï¸<br>Database

    U->>+C: POST /bookings (ì˜ˆì•½ ì •ë³´: roomId, userId, startTime, endTime, title)
    C->>+S: createBooking(bookingRequestDto)
    S->>S: 1. ì…ë ¥ ê°’ ìœ íš¨ì„± ê²€ì‚¬ (ì‹œê°„ ìˆœì„œ ë“±)
    S->>+R_Room: findById(roomId)
    R_Room->>+DB: SELECT * FROM rooms WHERE room_id = ?
    DB-->>-R_Room: íšŒì˜ì‹¤ ì •ë³´
    R_Room-->>-S: RoomEntity (ë˜ëŠ” Optional<RoomEntity>)
    S->>S: 2. íšŒì˜ì‹¤ ì¡´ì¬ ì—¬ë¶€ ë° ì˜ˆì•½ ê°€ëŠ¥ ì‹œê°„ í™•ì¸ (isRoomAvailable)
    S->>+R_Booking: findOverlappingBookings(roomId, startTime, endTime)
    R_Booking->>+DB: SELECT * FROM bookings WHERE room_id = ? AND ((start_time < ?) AND (end_time > ?)) -- ì¤‘ë³µ ì¡°ê±´ ì˜ˆì‹œ
    DB-->>-R_Booking: ì¤‘ë³µ ì˜ˆì•½ ëª©ë¡ (ì—†ìœ¼ë©´ empty list)
    R_Booking-->>-S: List<Booking> (empty)
    S->>S: 3. ì˜ˆì•½ ì •ë³´ ìƒì„± (BookingEntity)
    S->>+R_Booking: save(bookingEntity)
    R_Booking->>+DB: INSERT INTO bookings (...) VALUES (...)
    DB-->>-R_Booking: ì €ì¥ëœ BookingEntity (ID í¬í•¨)
    R_Booking-->>-S: savedBookingEntity
    S-->>-C: ì˜ˆì•½ ì„±ê³µ ì •ë³´ (BookingResponseDto)
    C-->>-U: HTTP 201 Created (ì˜ˆì•½ ì™„ë£Œ ì •ë³´)
```

---

### 3. API ëª…ì„¸ (API Specifications)

#### íšŒì˜ì‹¤ ì˜ˆì•½ API: `POST /bookings`

- **Description**: ìƒˆë¡œìš´ íšŒì˜ì‹¤ ì˜ˆì•½ì„ ìƒì„±í•©ë‹ˆë‹¤.
- **Request**:
    - **URL**: `/bookings`
    - **HTTP Method**: `POST`
    - **Headers**:
        - `Content-Type: application/json`
        - `Authorization: Bearer <token>` (í•„ìš”ì‹œ ì¸ì¦ í† í°)
    - **Request Body** (`BookingRequestDto`):
        
        JSON
        
        ```
        {
          "roomId": "CONF_ROOM_101",
          "userId": "user_abc123",
          "startTime": "2025-07-15T10:00:00Z",
          "endTime": "2025-07-15T11:00:00Z",
          "title": "ì£¼ê°„ íŒ€ ë¯¸íŒ…"
        }
        ```
        
- **Response**:
    - **Success (201 Created)**:
        - **Headers**: `Location: /bookings/{bookingId}`
        - **Body** (`BookingResponseDto`):
            
            JSON
            
            ```
            {
              "bookingId": "bk_xyz789",
              "roomId": "CONF_ROOM_101",
              "userId": "user_abc123",
              "startTime": "2025-07-15T10:00:00Z",
              "endTime": "2025-07-15T11:00:00Z",
              "title": "ì£¼ê°„ íŒ€ ë¯¸íŒ…",
              "status": "CONFIRMED"
            }
            ```
            
    - **Failure**:
        - **400 Bad Request** (ì…ë ¥ ê°’ ì˜¤ë¥˜)
        - **404 Not Found** (íšŒì˜ì‹¤ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ)
        - **409 Conflict** (ì˜ˆì•½ ì‹œê°„ ì¤‘ë³µ)
        - **401 Unauthorized** (ì¸ì¦ ì‹¤íŒ¨)
        - **500 Internal Server Error** (ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜)

---

### 4. ë°ì´í„° ëª¨ë¸ (Data Model)

```sql
-- Rooms Table: íšŒì˜ì‹¤ ì •ë³´
CREATE TABLE Rooms (
    room_id     VARCHAR2(50 CHAR) CONSTRAINT pk_rooms PRIMARY KEY,
    name        VARCHAR2(100 CHAR) NOT NULL,
    capacity    NUMBER NOT NULL,
    location    VARCHAR2(255 CHAR),
    description CLOB,
    created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

COMMENT ON TABLE Rooms IS 'íšŒì˜ì‹¤ ì •ë³´ í…Œì´ë¸”';
COMMENT ON COLUMN Rooms.room_id IS 'íšŒì˜ì‹¤ ê³ ìœ  ID';
COMMENT ON COLUMN Rooms.name IS 'íšŒì˜ì‹¤ ì´ë¦„';
COMMENT ON COLUMN Rooms.capacity IS 'ìˆ˜ìš© ê°€ëŠ¥ ì¸ì›';
COMMENT ON COLUMN Rooms.location IS 'ìœ„ì¹˜ (ì˜ˆ: ë³¸ì‚¬ 3ì¸µ Aêµ¬ì—­)';
COMMENT ON COLUMN Rooms.description IS 'ê¸°íƒ€ ì„¤ëª…';
COMMENT ON COLUMN Rooms.created_at IS 'ìƒì„± ì¼ì‹œ';
COMMENT ON COLUMN Rooms.updated_at IS 'ìˆ˜ì • ì¼ì‹œ';

-- Bookings Table: ì˜ˆì•½ ì •ë³´
CREATE TABLE Bookings (
    booking_id  VARCHAR2(50 CHAR) CONSTRAINT pk_bookings PRIMARY KEY,
    room_id     VARCHAR2(50 CHAR) NOT NULL,
    user_id     VARCHAR2(50 CHAR) NOT NULL,
    start_time  TIMESTAMP NOT NULL,
    end_time    TIMESTAMP NOT NULL,
    title       VARCHAR2(255 CHAR) NOT NULL,
    status      VARCHAR2(20 CHAR) DEFAULT 'CONFIRMED' NOT NULL
                CONSTRAINT chk_booking_status CHECK (status IN ('PENDING', 'CONFIRMED', 'CANCELLED', 'COMPLETED')),
    created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_bookings_room_id FOREIGN KEY (room_id) REFERENCES Rooms(room_id)
);

COMMENT ON TABLE Bookings IS 'ì˜ˆì•½ ì •ë³´ í…Œì´ë¸”';
COMMENT ON COLUMN Bookings.booking_id IS 'ì˜ˆì•½ ê³ ìœ  ID';
COMMENT ON COLUMN Bookings.room_id IS 'Rooms í…Œì´ë¸”ì˜ room_id ì°¸ì¡° (FK)';
COMMENT ON COLUMN Bookings.user_id IS 'ì˜ˆì•½ì„ ìƒì„±í•œ ì‚¬ìš©ì ID';
COMMENT ON COLUMN Bookings.start_time IS 'ì˜ˆì•½ ì‹œì‘ ì‹œê°„ (UTC)';
COMMENT ON COLUMN Bookings.end_time IS 'ì˜ˆì•½ ì¢…ë£Œ ì‹œê°„ (UTC)';
COMMENT ON COLUMN Bookings.title IS 'ì˜ˆì•½ ëª©ì  ë˜ëŠ” ì œëª©';
COMMENT ON COLUMN Bookings.status IS 'ì˜ˆì•½ ìƒíƒœ (PENDING, CONFIRMED, CANCELLED, COMPLETED)';
COMMENT ON COLUMN Bookings.created_at IS 'ìƒì„± ì¼ì‹œ';
COMMENT ON COLUMN Bookings.updated_at IS 'ìˆ˜ì • ì¼ì‹œ';

-- Indexes for Bookings Table
CREATE INDEX idx_bookings_room_time ON Bookings(room_id, start_time, end_time);
CREATE INDEX idx_bookings_user_id ON Bookings(user_id);
CREATE INDEX idx_bookings_status ON Bookings(status);

-- Triggers for automatic updated_at (Oracle doesn't support ON UPDATE CURRENT_TIMESTAMP in table DDL)
CREATE OR REPLACE TRIGGER trg_rooms_updated_at
BEFORE UPDATE ON Rooms
FOR EACH ROW
BEGIN
    :NEW.updated_at := CURRENT_TIMESTAMP;
END;
/

CREATE OR REPLACE TRIGGER trg_bookings_updated_at
BEFORE UPDATE ON Bookings
FOR EACH ROW
BEGIN
    :NEW.updated_at := CURRENT_TIMESTAMP;
END;
/
```

